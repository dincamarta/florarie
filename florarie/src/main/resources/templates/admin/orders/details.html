<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin - Detalii ComandÄƒ</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
<div class="admin-details-page">
    <!-- Header Section -->
    <div class="details-hero">
        <div class="details-hero-content">
            <div class="hero-title-section">
                <h1>ğŸ“‹ ComandÄƒ #<span th:text="${order.id}">1</span></h1>
                <span class="status-badge-large" th:classappend="${order.status.name()}" th:text="${order.status}">NEW</span>
            </div>
            <p class="hero-subtitle">Vizualizare È™i gestionare detalii comandÄƒ</p>
        </div>
    </div>

    <!-- Navigation Bar -->
    <div class="details-nav-bar">
        <a class="nav-btn" th:href="@{/admin/orders}">â† Toate Comenzile</a>
        <a class="nav-btn" th:href="@{/admin/flowers}">ğŸŒ¸ Admin Flori</a>
        <a class="nav-btn" th:href="@{/}">ğŸ  Home</a>
    </div>

    <!-- Main Content Grid -->
    <div class="admin-details-content">
        <!-- Left Column: Order Info & Customer -->
        <div class="details-column-left">
            <!-- Customer Info Card -->
            <div class="info-card">
                <div class="card-header">
                    <h2>ğŸ‘¤ InformaÈ›ii Client</h2>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="info-icon">ğŸ“§</span>
                        <div class="info-details">
                            <span class="info-label">Email:</span>
                            <span class="info-value" th:text="${order.user != null ? order.user.email : 'N/A'}">user@example.com</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-icon">ğŸ“</span>
                        <div class="info-details">
                            <span class="info-label">Telefon:</span>
                            <span class="info-value" th:text="${order.phone}">0712345678</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-icon">ğŸ“</span>
                        <div class="info-details">
                            <span class="info-label">AdresÄƒ livrare:</span>
                            <span class="info-value" th:text="${order.deliveryAddress}">Str. Florilor nr. 10</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-icon">ğŸ’°</span>
                        <div class="info-details">
                            <span class="info-label">Total comandÄƒ:</span>
                            <span class="info-value price-large" th:text="${order.total} + ' RON'">100 RON</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Change Status Card -->
            <div class="info-card">
                <div class="card-header">
                    <h2>ğŸ”„ Gestionare Status</h2>
                </div>
                <div class="card-body">
                    <form class="status-change-form" th:action="@{/admin/orders/{id}/status(id=${order.id})}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <div class="form-group">
                            <label>Status curent: <strong th:text="${order.status}">NEW</strong></label>
                            <select name="status" class="status-select">
                                <option th:each="s : ${allStatuses}"
                                        th:value="${s}"
                                        th:text="${s}"
                                        th:selected="${s == order.status}">
                                </option>
                            </select>
                            <button type="submit" class="btn-primary-large">ğŸ’¾ SalveazÄƒ Status</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Deadline Card -->
            <div class="info-card">
                <div class="card-header">
                    <h2>â° Deadline ComandÄƒ</h2>
                </div>
                <div class="card-body">
                    <div class="deadline-current">
                        <span class="deadline-label">Termen limitÄƒ actual:</span>
                        <span class="deadline-value" th:text="${order.requiredBy != null ? #temporals.format(order.requiredBy, 'dd MMM yyyy, HH:mm') : 'Nesetat'}">â€”</span>
                    </div>
                    <form class="deadline-form" th:action="@{/admin/orders/{id}/deadline(id=${order.id})}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <div class="form-group">
                            <label>SeteazÄƒ deadline nou:</label>
                            <input type="datetime-local" name="requiredBy" class="datetime-input"
                                   th:value="${order.requiredBy != null ? #temporals.format(order.requiredBy, 'yyyy-MM-dd''T''HH:mm') : ''}"/>
                            <button type="submit" class="btn-primary-large">ğŸ“… ActualizeazÄƒ Deadline</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Column: Products & Steps -->
        <div class="details-column-right">
            <!-- Products Card -->
            <div class="info-card">
                <div class="card-header">
                    <h2>ğŸŒ¸ Produse Comandate</h2>
                </div>
                <div class="card-body">
                    <div class="products-grid">
                        <div class="product-item" th:each="it : ${order.items}">
                            <div class="product-main">
                                <span class="product-name" th:text="${it.flowerName}">Trandafir</span>
                                <span class="product-quantity">Ã— <span th:text="${it.quantity}">5</span></span>
                            </div>
                            <div class="product-pricing">
                                <span class="product-unit-price" th:text="${it.unitPrice} + ' RON'">10 RON</span>
                                <span class="product-total" th:text="${it.lineTotal} + ' RON'">50 RON</span>
                            </div>
                        </div>
                    </div>
                    <div class="products-total">
                        <span class="total-label">Total:</span>
                        <span class="total-value" th:text="${order.total} + ' RON'">100 RON</span>
                    </div>
                </div>
            </div>

            <!-- Steps Card -->
            <div class="info-card">
                <div class="card-header">
                    <h2>ğŸ“Š Etape ProducÈ›ie</h2>
                </div>
                <div class="card-body">
                    <div th:if="${#lists.isEmpty(steps)}" class="empty-steps">
                        <p class="empty-message">ğŸ“¦ Nu existÄƒ etape pentru aceastÄƒ comandÄƒ</p>
                        <form th:action="@{/admin/orders/{id}/steps/init(id=${order.id})}" method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn-init-steps">ğŸš€ IniÈ›ializeazÄƒ Etape</button>
                        </form>
                    </div>

                    <div th:unless="${#lists.isEmpty(steps)}" class="steps-list">
                        <div class="step-item" th:each="s : ${steps}" th:classappend="${s.done ? 'step-done' : 'step-pending'}">
                            <div class="step-header">
                                <div class="step-status-icon" th:text="${s.done ? 'âœ…' : 'â³'}">â³</div>
                                <div class="step-info">
                                    <h4 class="step-name" th:text="${s.name}">Selectare flori</h4>
                                    <span class="step-status-text" th:text="${s.done ? 'FinalizatÄƒ' : 'Ãn aÈ™teptare'}">Ãn aÈ™teptare</span>
                                </div>
                            </div>
                            
                            <div class="step-timeline">
                                <div class="timeline-item">
                                    <span class="timeline-label">ğŸ“… Ãnceput:</span>
                                    <span class="timeline-value" th:text="${planByName[s.name] != null ? #temporals.format(planByName[s.name].startAt(), 'dd MMM HH:mm') : 'â€”'}">â€”</span>
                                </div>
                                <div class="timeline-item">
                                    <span class="timeline-label">â° Termen:</span>
                                    <span class="timeline-value" th:text="${planByName[s.name] != null ? #temporals.format(planByName[s.name].dueAt(), 'dd MMM HH:mm') : 'â€”'}">â€”</span>
                                </div>
                            </div>

                            <form class="step-action-form" th:action="@{/admin/orders/{oid}/steps/{sid}/toggle(oid=${order.id}, sid=${s.id})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="btn-toggle-step" th:classappend="${s.done ? 'btn-undone' : 'btn-done'}" 
                                        th:text="${s.done ? 'â†©ï¸ MarcheazÄƒ nefinalizatÄƒ' : 'âœ“ MarcheazÄƒ finalizatÄƒ'}">
                                    FinalizeazÄƒ
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
